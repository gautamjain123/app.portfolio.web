<div class="ai-card">
  <div class="ai-header">
    <div>
      <h4 class="mb-1 fw-bold title">ğŸ¯ Interview Arena</h4>
      <p class="mb-0 subtitle">Practice Angular interviews with AI + score + streak</p>
    </div>

    <div class="d-flex gap-2 flex-wrap justify-content-end">
      <span class="badge badge-soft">
        â± {{ formatTime(timerSec) }}
      </span>

      <span class="badge badge-soft">
        ğŸ”¥ Streak: <b class="ms-1">{{ streak }}</b>
      </span>

      <!-- âœ… show progress only in test mode -->
      <span class="badge badge-soft" *ngIf="isTestMode && currentQuestionNo > 0">
        ğŸ§¾ Question: <b class="ms-1">{{ currentQuestionNo }}</b> / {{ totalQuestions }}
      </span>
    </div>
  </div>

  <!-- Controls -->
  <div class="ai-controls row g-3">
    <div class="col-12 col-lg-5">
      <label class="form-label fw-semibold text-white-50">Topic</label>
      <input
        class="form-control ai-textarea"
        [(ngModel)]="topic"
        placeholder="Angular / RxJS / TS / HTML / CSS"
      />
    </div>

    <div class="col-12 col-lg-3">
      <label class="form-label fw-semibold text-white-50">Difficulty</label>
      <select class="form-select ai-select" [(ngModel)]="difficulty">
        <option value="easy">Easy</option>
        <option value="medium">Medium</option>
        <option value="hard">Hard</option>
      </select>
    </div>

    <div class="col-12 col-lg-4 d-flex align-items-end justify-content-lg-end gap-2">
      <button type="button" class="btn btn-outline-light ai-btn" (click)="resetTimer()">
        Reset Timer
      </button>

      <!-- âœ… Start test -->
      <button type="button" class="btn btn-outline-light ai-btn" (click)="startTest()" [disabled]="loadingQ">
        Start Test (10Q)
      </button>

      <!-- âœ… practice mode only -->
      <button
        *ngIf="!isTestMode"
        type="button"
        class="btn btn-light ai-btn-primary"
        (click)="generateQuestion()"
        [disabled]="loadingQ"
      >
        <span *ngIf="loadingQ" class="spinner-border spinner-border-sm me-2"></span>
        Generate Q
      </button>
    </div>
  </div>

  <!-- âœ… success msg -->
  <div class="alert alert-success mt-4" *ngIf="testCompletedMsg">
    {{ testCompletedMsg }}
  </div>

  <!-- âœ… error msg -->
  <div class="alert alert-danger mt-4" *ngIf="errorMsg">
    <b>Error:</b> {{ errorMsg }}
  </div>

  <!-- MAIN GRID -->
  <div class="arena-grid mt-4" *ngIf="question">
    <!-- Left -->
    <div class="arena-card">
      <div class="arena-head">
        <div class="arena-title">ğŸ“Œ Question</div>
        <button type="button" class="mini-btn" (click)="copy(question)">Copy</button>
      </div>

      <div class="arena-body">
        <div class="q">{{ question }}</div>

        <div class="mt-3" *ngIf="keyPoints.length">
          <div class="sub">âœ… Key Points</div>
          <ul class="list">
            <li *ngFor="let k of keyPoints">{{ k }}</li>
          </ul>
        </div>

        <!-- âŒ Follow ups removed -->
      </div>
    </div>

    <!-- Right -->
    <div class="arena-card">
      <div class="arena-head">
        <div class="arena-title">âœï¸ Your Answer</div>
        <div class="d-flex gap-2">
          <button type="button" class="mini-btn" (click)="copy(answer)">Copy</button>
          <button type="button" class="mini-btn" (click)="pauseTimer()" *ngIf="timerRunning">Pause</button>
          <button type="button" class="mini-btn" (click)="startTimer()" *ngIf="!timerRunning">Resume</button>
        </div>
      </div>

      <div class="arena-body">
        <textarea
          class="form-control ai-textarea"
          rows="12"
          [(ngModel)]="answer"
          placeholder="Write your answer like you're in a real interview..."
          [disabled]="loadingEval || isAnswerLocked"
        ></textarea>

        <div class="d-flex justify-content-end mt-3 gap-2">
          <button
            type="button"
            class="btn btn-light ai-btn-primary"
            (click)="evaluate()"
            [disabled]="loadingEval || isAnswerLocked || !answer.trim()"
          >
            <span *ngIf="loadingEval" class="spinner-border spinner-border-sm me-2"></span>
            {{ isAnswerLocked ? 'Evaluated âœ…' : 'Evaluate ğŸ¯' }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- RESULT -->
  <div class="mt-4" *ngIf="score && !loadingEval">
    <div class="result-card">
      <div class="result-top">
        <div class="score">
          âœ… Score: <b>{{ score }}</b>
        </div>
        <button type="button" class="mini-btn" (click)="copy(idealAnswer)">Copy Ideal</button>
      </div>

      <div class="result-body">
        <div class="sub">ğŸ§  Feedback</div>
        <div class="text">{{ feedback }}</div>

        <div class="mt-3" *ngIf="missingPoints.length">
          <div class="sub">âŒ Missing Points</div>
          <ul class="list">
            <li *ngFor="let m of missingPoints">{{ m }}</li>
          </ul>
        </div>

        <div class="mt-3" *ngIf="idealAnswer">
          <div class="sub">âœ… Ideal Answer</div>
          <pre class="raw">{{ idealAnswer }}</pre>
        </div>

        <!-- âœ… NEXT QUESTION -->
        <div class="mt-3" *ngIf="isTestMode && isAnswerLocked && currentQuestionNo < totalQuestions">
          <div class="d-flex justify-content-end mt-3">
            <button type="button" class="btn btn-outline-light ai-btn" (click)="next()">
              Start Next Question â†’
            </button>
          </div>
        </div>

        <!-- âœ… show completed state -->
        <div class="mt-3" *ngIf="isTestMode && currentQuestionNo >= totalQuestions">
          <div class="sub">âœ… Test Completed</div>
          <div class="text">You have completed <b>{{ totalQuestions }}</b> questions.</div>
        </div>
      </div>
    </div>
  </div>
</div>
